<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover, shrink-to-fit=no" />
<meta name="theme-color" content="#1976d2" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="Paludario" />
<meta name="description" content="Gestione completa del paludario - Valori acqua, programmazione luci e sistemi" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="msapplication-TileColor" content="#1976d2" />
<meta name="msapplication-tap-highlight" content="no" />

<!-- PWA Manifest -->
<link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Paludario&quot;,&quot;short_name&quot;:&quot;Paludario&quot;,&quot;description&quot;:&quot;Gestione completa del paludario&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#ffffff&quot;,&quot;theme_color&quot;:&quot;#1976d2&quot;,&quot;orientation&quot;:&quot;portrait&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMxOTc2ZDIiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/svg+xml&quot;},{&quot;src&quot;:&quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiByeD0iNjQiIGZpbGw9IiMxOTc2ZDIiLz4KPHN2ZyB4PSIxMjgiIHk9IjEyOCIgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xMiAyTDEzLjA5IDguMjZMMjAgOUwxMy4wOSAxNS43NEwxMiAyMkwxMC45MSAxNS43NEw0IDlMMTAuOTEgOC4yNkwxMiAyWiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+Cjwvc3ZnPg==&quot;,&quot;sizes&quot;:&quot;512x512&quot;,&quot;type&quot;:&quot;image/svg+xml&quot;}]}" />

<!-- Apple Touch Icons -->
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMxOTc2ZDIiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+" />
<link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iMjIiIGZpbGw9IiMxOTc2ZDIiLz4KPHN2ZyB4PSI0NSIgeT0iNDUiIHdpZHRoPSI5MCIgaGVpZ2h0PSI5MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+" />

<title>Paludario</title>
<style>
	/* Mobile-first CSS ottimizzato con tema paludario moderno */
	:root {
		--primary-green: #2e7d32;
		--primary-blue: #1976d2;
		--accent-teal: #00695c;
		--accent-orange: #ff8f00;
		--background-light: linear-gradient(135deg, #f8fffe 0%, #e8f5e8 100%);
		--background-dark: linear-gradient(135deg, #000000 0%, #0a0a0a 100%);
		--card-light: rgba(255, 255, 255, 0.9);
		--card-dark: rgba(25, 35, 25, 0.95);
		--shadow-light: 0 4px 20px rgba(46, 125, 50, 0.1);
		--shadow-dark: 0 4px 20px rgba(0, 0, 0, 0.5);
	}
	
	body { 
		font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
		margin: 0;
		padding: 20px;
		background: var(--background-light);
		min-height: 100vh;
		-webkit-text-size-adjust: 100%;
		-webkit-tap-highlight-color: transparent;
		transition: all 0.3s ease;
	}
	
	.dark-mode {
		background: var(--background-dark) !important;
		color: #f0f0f0 !important;
	}
	
	.dark-mode body {
		background: var(--background-dark) !important;
		color: #f0f0f0 !important;
	}
	
	.dark-mode html {
		background: var(--background-dark) !important;
	}
	
	/* Pulsanti moderni con tema paludario */
	button { 
		cursor: pointer; 
		min-height: 48px;
		min-width: 48px;
		padding: 14px 20px;
		font-size: 16px;
		font-weight: 600;
		border-radius: 12px;
		border: none;
		background: linear-gradient(135deg, var(--primary-green) 0%, var(--accent-teal) 100%);
		color: white;
		box-shadow: var(--shadow-light);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		position: relative;
		overflow: hidden;
	}
	
	button::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
		transition: left 0.5s;
	}
	
	button:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 25px rgba(46, 125, 50, 0.3);
	}
	
	button:hover::before {
		left: 100%;
	}
	
	button:active {
		transform: translateY(0);
		box-shadow: 0 4px 15px rgba(46, 125, 50, 0.2);
	}
	
	.dark-mode button {
		background: linear-gradient(135deg, var(--accent-teal) 0%, var(--primary-green) 100%);
		box-shadow: var(--shadow-dark);
	}
	
	.dark-mode button:hover {
		box-shadow: 0 8px 25px rgba(0, 105, 92, 0.4);
	}
	
	/* Input moderni */
	input, select {
		min-height: 48px;
		font-size: 16px;
		font-weight: 500;
		padding: 14px 16px;
		border-radius: 12px;
		border: 2px solid rgba(46, 125, 50, 0.2);
		background: var(--card-light);
		transition: all 0.3s ease;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
	}
	
	input:focus, select:focus {
		outline: none;
		border-color: var(--primary-green);
		box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
		transform: translateY(-1px);
	}
	
	.dark-mode input, .dark-mode select {
		background: var(--card-dark);
		border-color: rgba(0, 105, 92, 0.3);
		color: #e0e0e0;
	}
	
	.dark-mode input:focus, .dark-mode select:focus {
		border-color: var(--accent-teal);
		box-shadow: 0 0 0 3px rgba(0, 105, 92, 0.2);
	}
	
	/* Stili dark-mode per field e label */
	.dark-mode .field label {
		color: #e0e0e0 !important;
	}
	
	/* Stile specifico per il label del volume acqua in dark mode */
	.dark-mode label[for="liters"] {
		color: var(--accent-teal) !important;
	}
	
	/* Stile per il tile L in dark mode */
	.dark-mode #liters + .unit,
	.dark-mode .unit {
		background: #444 !important;
		color: #ccc !important;
		border-color: #666 !important;
	}
	
	.dark-mode select {
		background: var(--card-dark);
		border-color: rgba(0, 105, 92, 0.3);
		color: #e0e0e0;
	}
	
	/* Stile specifico per l'input del volume acqua in dark mode */
	.dark-mode #liters {
		background: var(--card-dark) !important;
		border-color: var(--primary-green) !important;
		color: #e0e0e0 !important;
	}
	
	.dark-mode #liters:focus {
		border-color: var(--accent-teal) !important;
		box-shadow: 0 0 0 3px rgba(0, 105, 92, 0.2) !important;
	}
	
	/* Titoli moderni */
	h1 { 
		margin: 0 0 24px 0; 
		font-size: 32px; 
		font-weight: 800;
		background: linear-gradient(135deg, var(--primary-green) 0%, var(--accent-teal) 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
		text-align: center;
		letter-spacing: -0.5px;
	}
	
	h2 { 
		margin: 32px 0 20px 0; 
		font-size: 24px; 
		font-weight: 700;
		color: var(--primary-green);
		position: relative;
		padding-left: 16px;
	}
	
	h2::before {
		content: '';
		position: absolute;
		left: 0;
		top: 50%;
		transform: translateY(-50%);
		width: 4px;
		height: 24px;
		background: linear-gradient(135deg, var(--primary-green) 0%, var(--accent-teal) 100%);
		border-radius: 2px;
	}
	
	.dark-mode h1 {
		background: linear-gradient(135deg, var(--accent-teal) 0%, var(--primary-green) 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}
	
	.dark-mode h2 {
		color: var(--accent-teal);
	}
	
	/* Fieldset moderni */
	fieldset { 
		border: none;
		padding: 24px; 
		margin: 24px 0; 
		border-radius: 16px;
		background: var(--card-light);
		box-shadow: var(--shadow-light);
		position: relative;
		overflow: hidden;
	}
	
	/* Tabella luci RGB - usa le stesse regole delle altre tabelle */
	#light-table {
		width: 1200px !important;
		min-width: 1200px !important;
		table-layout: fixed !important;
	}
	
	fieldset::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		height: 4px;
		background: linear-gradient(90deg, var(--primary-green) 0%, var(--accent-teal) 50%, var(--primary-blue) 100%);
	}
	
	.dark-mode fieldset {
		background: rgba(20, 30, 20, 0.9);
		box-shadow: var(--shadow-dark);
	}
	
	legend { 
		padding: 8px 16px; 
		font-weight: 700; 
		font-size: 18px;
		background: linear-gradient(135deg, var(--primary-green) 0%, var(--accent-teal) 100%);
		color: white;
		border-radius: 12px;
		margin-left: 16px;
		box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
	}
	
	.dark-mode legend {
		background: linear-gradient(135deg, var(--accent-teal) 0%, var(--primary-green) 100%);
		box-shadow: 0 4px 12px rgba(0, 105, 92, 0.4);
	}
	
	.row { 
		display: flex; 
		flex-wrap: wrap; 
		gap: 12px 16px; 
		align-items: center; 
		margin-bottom: 12px;
	}
	.field { 
		display: inline-flex; 
		align-items: center; 
		gap: 8px; 
		min-height: 44px;
	}
	.field label { 
		margin: 0; 
		font-weight: 500; 
		font-size: 14px;
		white-space: nowrap;
	}
	
	.unit { 
		font-size: 12px; 
		color: #555; 
		background: #f3f3f3; 
		border: 1px solid #e0e0e0; 
		padding: 4px 8px; 
		border-radius: 6px; 
	}
	
	input[type="number"] { width: 100px; }
	input[type="time"] { width: 120px; }
	input[type="datetime-local"] { width: 200px; }
	
	/* Tabelle moderne */
	table {
		border-collapse: collapse;
		width: 100%;
		margin-top: 16px;
		font-size: 15px;
		background: var(--card-light);
		border-radius: 12px;
		overflow: hidden;
		box-shadow: var(--shadow-light);
	}
	
	
	th, td { 
		border: none;
		padding: 12px 16px; 
		text-align: left; 
		transition: all 0.2s ease;
	}
	
	th {
		background: linear-gradient(135deg, var(--primary-green) 0%, var(--accent-teal) 100%);
		color: white;
		font-weight: 700;
		font-size: 14px;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}
	
	tr:nth-child(even) {
		background: rgba(46, 125, 50, 0.02);
	}
	
	tr:hover {
		background: rgba(46, 125, 50, 0.05);
		transform: scale(1.01);
	}
	
	.dark-mode table {
		background: rgba(20, 30, 20, 0.9);
		box-shadow: var(--shadow-dark);
	}
	
	.dark-mode th {
		background: linear-gradient(135deg, var(--accent-teal) 0%, var(--primary-green) 100%);
	}
	
	.dark-mode tr:nth-child(even) {
		background: rgba(0, 105, 92, 0.05);
	}
	
	.dark-mode tr:hover {
		background: rgba(0, 105, 92, 0.1);
	}
	
	.grid { display: grid; gap: 16px; }
	.grid-2 { grid-template-columns: 1fr; }
	
	.mono { 
		font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; 
		font-size: 13px;
	}
	
	canvas { 
		width: 100%; 
		height: 200px; 
		max-height: 50vh; 
		border: 1px solid #eee; 
		background: #fff; 
		border-radius: 8px;
	}
	
	.legend { 
		display: flex; 
		flex-wrap: wrap; 
		gap: 12px; 
		margin: 12px 0 0 0; 
		padding: 16px;
		background: var(--card-light);
		border-radius: 12px;
		box-shadow: var(--shadow-light);
	}
	.legend span { 
		display: inline-flex; 
		align-items: center; 
		gap: 8px; 
		font-size: 13px; 
		font-weight: 500;
		padding: 8px 12px;
		background: rgba(255, 255, 255, 0.8);
		border-radius: 8px;
		border: 1px solid rgba(0, 0, 0, 0.1);
		transition: all 0.2s ease;
	}
	.legend span:hover {
		background: rgba(255, 255, 255, 1);
		transform: translateY(-1px);
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	}
	.legend i { 
		width: 16px; 
		height: 4px; 
		display: inline-block; 
		border-radius: 2px;
	}
	
	/* Dark mode per la legenda */
	.dark-mode .legend {
		background: var(--card-dark);
		box-shadow: var(--shadow-dark);
	}
	
	.dark-mode .legend span {
		background: rgba(45, 45, 45, 0.8);
		border-color: rgba(255, 255, 255, 0.1);
		color: #e0e0e0;
	}
	
	.dark-mode .legend span:hover {
		background: rgba(45, 45, 45, 1);
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
	}
	
	.tiny { 
		font-size: 12px; 
		padding: 6px 10px; 
		line-height: 1.4; 
		min-height: 32px;
	}
	
	.color-dot { 
		width: 14px; 
		height: 14px; 
		border-radius: 50%; 
		display: inline-block; 
		margin-right: 6px; 
	}
	.color-dot.red { background: #e53935; }
	
	.dark-mode .color-dot.red { 
		background: #ff5252 !important; 
		box-shadow: 0 0 4px rgba(255, 82, 82, 0.5) !important;
	}
	.color-dot.green { background: #43a047; }
	.color-dot.blue { background: #1e88e5; }
	.color-dot.white { background: #757575; }
	.color-dot.orange { background: #ff9800; }
	
	/* Status indicator */
	.status-indicator {
		background: #4caf50;
		color: white;
		padding: 6px 12px;
		border-radius: 6px;
		font-size: 12px;
		font-weight: bold;
		box-shadow: none;
		margin: 0;
	}
	.status-indicator.syncing {
		background: #ff9800;
	}
	.status-indicator.error {
		background: #f44336;
	}
	
	/* Dark mode styles */
	.dark-mode {
		background-color: #1a1a1a !important;
		color: #ffffff !important;
	}
	.dark-mode th {
		background: #333 !important;
		color: #ffffff !important;
	}
	.dark-mode fieldset {
		border-color: #555 !important;
	}
	.dark-mode legend {
		color: #ffffff !important;
	}
	.dark-mode .unit {
		background: #444 !important;
		color: #ccc !important;
		border-color: #666 !important;
	}
	.dark-mode input, .dark-mode select {
		background: #333 !important;
		color: #ffffff !important;
		border-color: #555 !important;
	}
	.dark-mode canvas {
		background: #222 !important;
		border-color: #555 !important;
	}
	
	/* Container del grafico acqua in dark mode */
	.water-chart-controls {
		background: rgba(255, 255, 255, 0.05);
		padding: 16px;
		border-radius: 12px;
		border: 1px solid rgba(46, 125, 50, 0.2);
		margin-bottom: 16px;
		transition: all 0.3s ease;
	}
	
	.dark-mode .water-chart-controls {
		background: rgba(20, 30, 20, 0.8);
		border-color: rgba(0, 105, 92, 0.3);
		box-shadow: var(--shadow-dark);
	}
	
	.dark-mode .water-chart-controls:hover {
		background: rgba(25, 35, 25, 1);
		border-color: rgba(0, 105, 92, 0.5);
	}
	.dark-mode button {
		background: #444 !important;
		color: #ffffff !important;
		border-color: #666 !important;
	}
	.dark-mode button:hover {
		background: #555 !important;
	}
	.dark-mode #sync-data {
		background: #64b5f6 !important;
		color: #000 !important;
	}
	
	/* Stili per le colonne delle variazioni percentuali */
	.variation-column {
		font-size: 11px !important;
		font-weight: bold !important;
		text-align: center !important;
		min-width: 60px !important;
		padding: 4px !important;
	}
	
	.variation-positive {
		background: #e8f5e8 !important;
		color: #2e7d32 !important;
	}
	
	.variation-negative {
		background: #ffebee !important;
		color: #d32f2f !important;
	}
	
	.variation-neutral {
		background: #f5f5f5 !important;
		color: #666 !important;
	}
	
	.dark-mode .variation-positive {
		background: #1b5e20 !important;
		color: #81c784 !important;
	}
	
	.dark-mode .variation-negative {
		background: #d32f2f !important;
		color: #ffcdd2 !important;
		font-weight: bold !important;
		text-shadow: 0 0 2px rgba(255, 255, 255, 0.3) !important;
	}
	
	.dark-mode .variation-neutral {
		background: #424242 !important;
		color: #bdbdbd !important;
	}
	
	/* Stili migliorati per valori rossi in dark mode */
	.dark-mode td:has(.variation-negative),
	.dark-mode .variation-column.variation-negative {
		background: #d32f2f !important;
		color: #ffcdd2 !important;
		font-weight: bold !important;
		text-shadow: 0 0 2px rgba(255, 255, 255, 0.3) !important;
		border: 1px solid #ff5252 !important;
	}
	
	/* Evidenziazione per celle con valori critici in dark mode */
	.dark-mode td[style*="color: red"],
	.dark-mode td[style*="background: red"] {
		background: #d32f2f !important;
		color: #ffcdd2 !important;
		font-weight: bold !important;
		text-shadow: 0 0 2px rgba(255, 255, 255, 0.3) !important;
		border: 1px solid #ff5252 !important;
	}
	
	/* Forza i colori rossi per valori fuori soglia in dark mode */
	.dark-mode input[style*="background: #ffebee"],
	.dark-mode input[style*="border-color: #f44336"],
	.dark-mode input[style*="color: #d32f2f"] {
		background: #ffebee !important;
		border-color: #f44336 !important;
		color: #d32f2f !important;
		font-weight: bold !important;
	}
	
	/* Stili per la sezione animali */
	#animals-table select {
		background: transparent !important;
		border: none !important;
		color: inherit !important;
		font-size: inherit !important;
		padding: 4px !important;
		border-radius: 4px !important;
		cursor: pointer !important;
	}
	
	#animals-table select:hover {
		background: rgba(0, 0, 0, 0.1) !important;
	}
	
	.dark-mode #animals-table select:hover {
		background: rgba(255, 255, 255, 0.1) !important;
	}
	
	/* Stili per i pulsanti di azione nella tabella animali */
	#animals-table button {
		min-height: 32px !important;
		min-width: 32px !important;
		padding: 4px 8px !important;
		font-size: 12px !important;
		margin: 2px !important;
	}
	
	/* Animazione per l'icona degli animali */
	.animated-icon.bounce {
		animation: bounce 2s ease-in-out infinite;
	}
	
	/* Stili per la console di controllo */
	#control-console {
		position: fixed !important;
		top: 0 !important;
		right: 0 !important;
		z-index: 9999 !important;
		transition: all 0.3s ease;
		pointer-events: auto;
	}
	
	#control-console button:hover {
		transform: translateY(-2px) !important;
		box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
	}
	
	#control-console button:active {
		transform: translateY(0) !important;
	}
	
	#control-console:hover {
		background: rgba(255,255,255,0.98) !important;
		box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
	}
	
	.dark-mode #control-console {
		background: rgba(26, 26, 26, 0.95) !important;
		backdrop-filter: blur(10px) !important;
	}
	
	.dark-mode #control-console:hover {
		background: rgba(26, 26, 26, 0.98) !important;
		box-shadow: 0 4px 12px rgba(0,0,0,0.4) !important;
	}
	
	.dark-mode #control-console button {
		background: #444 !important;
		color: #ffffff !important;
		border-color: #666 !important;
	}
	
	.dark-mode #control-console button:hover {
		background: #555 !important;
	}
	
	.dark-mode #control-console #sync-data {
		background: #1976d2 !important;
		color: white !important;
	}
	
	.dark-mode #control-console #debug-sync {
		background: #ff9800 !important;
		color: white !important;
	}
	
	.dark-mode #control-console #dark-mode-toggle {
		background: #666 !important;
		color: white !important;
	}
	
	.dark-mode #control-console #mobile-toggle {
		background: #7b1fa2 !important;
		color: white !important;
	}
	
	/* Pulsanti rossi migliorati per dark mode */
	.dark-mode button[style*="background: #f44336"],
	.dark-mode button[style*="background: #d32f2f"],
	.dark-mode button[style*="background: #e53935"] {
		background: #ff5252 !important;
		color: #ffffff !important;
		box-shadow: 0 0 8px rgba(255, 82, 82, 0.4) !important;
		border: 1px solid #ff8a80 !important;
	}
	
	.dark-mode button[style*="background: #f44336"]:hover,
	.dark-mode button[style*="background: #d32f2f"]:hover,
	.dark-mode button[style*="background: #e53935"]:hover {
		background: #ff1744 !important;
		box-shadow: 0 0 12px rgba(255, 23, 68, 0.6) !important;
		transform: translateY(-2px) !important;
	}
	
	.dark-mode #last-sync {
		color: #cccccc !important;
	}
	
	/* Assicura che la console sia sempre inchiodata */
	body {
		margin: 0;
		padding: 0;
	}
	
	/* Previene scroll orizzontale */
	html, body {
		overflow-x: hidden;
	}
	
	/* Eccezione per container tabelle - permette scroll orizzontale */
	.table-container {
		overflow-x: auto !important;
		overflow-y: visible !important;
		width: 100% !important;
		display: block !important;
	}
	
	/* Forza scroll per container tabella luci */
	.table-container:has(#light-table) {
		overflow-x: auto !important;
		overflow-y: visible !important;
		width: 100% !important;
		display: block !important;
	}
	
	
	/* Modalità Mobile */
	.mobile-mode {
		font-size: 16px !important;
	}
	
	.mobile-mode body {
		margin: 0;
		padding: 12px;
		font-size: 16px;
	}
	
	.mobile-mode button {
		min-height: 48px !important;
		padding: 12px 16px !important;
		font-size: 16px !important;
		margin: 4px 0 !important;
		width: 100% !important;
		box-sizing: border-box !important;
	}
	
	.mobile-mode input, .mobile-mode select {
		min-height: 48px !important;
		font-size: 16px !important;
		padding: 12px !important;
		box-sizing: border-box !important;
		width: 100% !important;
		max-width: 100% !important;
	}
	
	/* Input time specifici per mobile */
	.mobile-mode input[type="time"] {
		width: 100% !important;
		min-width: 0 !important;
		font-size: 16px !important;
	}
	
	/* Regole generali per le tabelle mobile - ripristinate */
	.mobile-mode table {
		font-size: 14px !important;
		width: auto !important;
		min-width: 100% !important;
	}
	
	/* Escludi tabella animali dalle regole generali */
	.mobile-mode table:not(#animals-table) {
		font-size: 14px !important;
		width: auto !important;
		min-width: 100% !important;
	}
	
	/* Container scrollabile per la tabella su mobile */
	.mobile-mode .table-container {
		overflow-x: auto !important;
		width: 100% !important;
		-webkit-overflow-scrolling: touch !important; /* Scroll fluido su iOS */
		display: block !important; /* Forza display block per il container */
	}
	
	/* Forza la larghezza della tabella anche se ci sono conflitti */
	.mobile-mode #water-table {
		width: 1200px !important;
		min-width: 1200px !important;
		max-width: none !important;
		table-layout: fixed !important;
	}
	
	/* Regola molto specifica per sovrascrivere qualsiasi conflitto */
	body.mobile-mode .table-container table#water-table {
		width: 1200px !important;
		min-width: 1200px !important;
		max-width: none !important;
		table-layout: fixed !important;
	}
	
	/* Sovrascrivi regole generali per tabella animali */
	body.mobile-mode table#animals-table {
		width: 100vw !important;
		min-width: 100vw !important;
		max-width: none !important;
		table-layout: auto !important;
		display: table !important;
	}
	
	/* Tabella animali - larghezza adattiva per mobile */
	.mobile-mode #animals-table {
		width: 100vw !important;
		min-width: 100vw !important;
		max-width: none !important;
		table-layout: auto !important;
		display: table !important;
	}
	
	/* Regola molto specifica per sovrascrivere qualsiasi conflitto */
	body.mobile-mode .table-container table#animals-table {
		width: 100vw !important;
		min-width: 100vw !important;
		max-width: none !important;
		table-layout: auto !important;
		display: table !important;
	}
	
	/* Regola ancora più specifica per garantire l'applicazione */
	.mobile-mode .table-container:has(#animals-table) #animals-table {
		width: 100vw !important;
		min-width: 100vw !important;
		max-width: none !important;
		table-layout: auto !important;
		display: table !important;
	}
	
	/* Colonne specifiche per la tabella animali - larghezze adattive */
	.mobile-mode #animals-table th:nth-child(1), .mobile-mode #animals-table td:nth-child(1) {
		width: auto !important; /* Specie/Razza - si adatta al contenuto */
		min-width: 120px !important;
		max-width: 200px !important;
	}
	.mobile-mode #animals-table th:nth-child(2), .mobile-mode #animals-table td:nth-child(2) {
		width: auto !important; /* Tipo */
		min-width: 80px !important;
		max-width: 100px !important;
	}
	.mobile-mode #animals-table th:nth-child(3), .mobile-mode #animals-table td:nth-child(3) {
		width: auto !important; /* Esemplari */
		min-width: 60px !important;
		max-width: 80px !important;
	}
	.mobile-mode #animals-table th:nth-child(4), .mobile-mode #animals-table td:nth-child(4) {
		width: auto !important; /* Maschi */
		min-width: 60px !important;
		max-width: 80px !important;
	}
	.mobile-mode #animals-table th:nth-child(5), .mobile-mode #animals-table td:nth-child(5) {
		width: auto !important; /* Femmine */
		min-width: 60px !important;
		max-width: 80px !important;
	}
	.mobile-mode #animals-table th:nth-child(6), .mobile-mode #animals-table td:nth-child(6) {
		width: auto !important; /* Data Acquisto */
		min-width: 100px !important;
		max-width: 120px !important;
	}
	.mobile-mode #animals-table th:nth-child(7), .mobile-mode #animals-table td:nth-child(7) {
		width: auto !important; /* Stato */
		min-width: 70px !important;
		max-width: 90px !important;
	}
	.mobile-mode #animals-table th:nth-child(8), .mobile-mode #animals-table td:nth-child(8) {
		width: auto !important; /* Azioni */
		min-width: 80px !important;
		max-width: 100px !important;
	}
	
	/* Regole generali per celle mobile - ripristinate */
	.mobile-mode th, .mobile-mode td {
		padding: 8px 4px !important;
		font-size: 12px !important;
	}
	
	/* Colonne specifiche SOLO per la tabella valori acqua */
	.mobile-mode #water-table th:nth-child(1), .mobile-mode #water-table td:nth-child(1) {
		width: 280px !important; /* DATA/ORA - più spazio per date complete */
	}
	.mobile-mode #water-table th:nth-child(2), .mobile-mode #water-table td:nth-child(2) {
		width: 80px !important; /* PH */
	}
	.mobile-mode #water-table th:nth-child(3), .mobile-mode #water-table td:nth-child(3) {
		width: 80px !important; /* ΔPH% */
	}
	.mobile-mode #water-table th:nth-child(4), .mobile-mode #water-table td:nth-child(4) {
		width: 80px !important; /* KH */
	}
	.mobile-mode #water-table th:nth-child(5), .mobile-mode #water-table td:nth-child(5) {
		width: 80px !important; /* ΔKH% */
	}
	.mobile-mode #water-table th:nth-child(6), .mobile-mode #water-table td:nth-child(6) {
		width: 80px !important; /* GH */
	}
	.mobile-mode #water-table th:nth-child(7), .mobile-mode #water-table td:nth-child(7) {
		width: 80px !important; /* ΔGH% */
	}
	.mobile-mode #water-table th:nth-child(8), .mobile-mode #water-table td:nth-child(8) {
		width: 80px !important; /* NO2 */
	}
	.mobile-mode #water-table th:nth-child(9), .mobile-mode #water-table td:nth-child(9) {
		width: 80px !important; /* ΔNO2% */
	}
	.mobile-mode #water-table th:nth-child(10), .mobile-mode #water-table td:nth-child(10) {
		width: 80px !important; /* NO3 */
	}
	.mobile-mode #water-table th:nth-child(11), .mobile-mode #water-table td:nth-child(11) {
		width: 80px !important; /* ΔNO3% */
	}
	.mobile-mode #water-table th:nth-child(12), .mobile-mode #water-table td:nth-child(12) {
		width: 80px !important; /* NH4 */
	}
	.mobile-mode #water-table th:nth-child(13), .mobile-mode #water-table td:nth-child(13) {
		width: 80px !important; /* ΔNH4% */
	}
	.mobile-mode #water-table th:nth-child(14), .mobile-mode #water-table td:nth-child(14) {
		width: 80px !important; /* Temp °C */
	}
	.mobile-mode #water-table th:nth-child(15), .mobile-mode #water-table td:nth-child(15) {
		width: 80px !important; /* ΔTemp% */
	}
	
	/* Input nelle celle SOLO per la tabella valori acqua - dimensioni compatte */
	.mobile-mode #water-table td input {
		width: 100% !important;
		height: 24px !important; /* Altezza fissa molto ridotta */
		font-size: 12px !important; /* Font più piccolo */
		padding: 2px 4px !important; /* Padding minimo */
		border: 1px solid #ddd !important;
		border-radius: 3px !important;
		box-sizing: border-box !important;
		line-height: 1.2 !important; /* Line height compatto */
	}
	
	.mobile-mode #water-table td input:focus {
		border-color: var(--primary-green) !important;
		outline: none !important;
		box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2) !important;
	}
	
	/* Dark mode per input nelle celle della tabella valori acqua */
	.dark-mode .mobile-mode #water-table td input {
		background: #333 !important;
		color: #fff !important;
		border-color: #555 !important;
	}
	
	.dark-mode .mobile-mode #water-table td input:focus {
		border-color: var(--accent-teal) !important;
		box-shadow: 0 0 0 2px rgba(0, 105, 92, 0.3) !important;
	}
	
	/* Rimuove regole specifiche per celle tabella valori acqua - usa le regole generali */
	
	.mobile-mode .field {
		margin: 8px 0 !important;
		width: 100% !important;
		display: flex !important;
		flex-direction: column !important;
		align-items: stretch !important;
	}
	
	.mobile-mode .field label {
		font-size: 16px !important;
		margin-bottom: 6px !important;
		display: block !important;
		width: 100% !important;
	}
	
	.mobile-mode .field input {
		width: 100% !important;
		max-width: none !important;
		box-sizing: border-box !important;
		margin: 0 !important;
	}
	
	.mobile-mode .field .unit {
		margin-top: 6px !important;
		align-self: flex-start !important;
		width: auto !important;
		padding: 4px 8px !important;
		font-size: 12px !important;
	}
	
	.mobile-mode fieldset {
		margin: 16px 0 !important;
		padding: 12px !important;
	}
	
	.mobile-mode legend {
		font-size: 18px !important;
		padding: 0 8px !important;
	}
	
	/* Layout specifico per la sezione "Nuovo valore" in mobile */
	.mobile-mode .row {
		display: flex !important;
		flex-direction: column !important;
		gap: 12px !important;
		align-items: stretch !important;
		margin: 0 !important;
		padding: 0 !important;
	}
	
	.mobile-mode .row .field {
		flex: none !important;
		width: 100% !important;
		margin: 4px 0 !important;
	}
	
	/* Pulsanti compatti per mobile nella sezione nuovo valore */
	.mobile-mode #add-water,
	.mobile-mode #clear-water {
		width: calc(50% - 4px) !important;
		display: inline-block !important;
		margin: 8px 2px !important;
		font-size: 14px !important;
		padding: 10px 8px !important;
		min-height: 44px !important;
	}
	
	/* Input datetime-local ottimizzato per mobile */
	.mobile-mode #water-dt {
		width: 100% !important;
		max-width: none !important;
		font-size: 16px !important;
		min-width: 0 !important;
		box-sizing: border-box !important;
	}
	
	/* Pulsanti OK e Pulisci per datetime */
	.mobile-mode .ok-btn,
	.mobile-mode .clear-btn {
		width: calc(50% - 6px) !important;
		display: inline-block !important;
		margin: 6px 3px !important;
		font-size: 14px !important;
		padding: 10px 8px !important;
		min-height: 44px !important;
		box-sizing: border-box !important;
	}
	
	/* Ottimizzazioni specifiche per la sezione "Nuovo valore" */
	.mobile-mode fieldset legend {
		font-size: 16px !important;
		padding: 6px 12px !important;
		margin-bottom: 8px !important;
	}
	
	/* Riduce il padding del fieldset in mobile per più spazio */
	.mobile-mode fieldset {
		padding: 12px !important;
		margin: 12px 0 !important;
		box-sizing: border-box !important;
	}
	
	/* Ottimizza la riga con datetime-local */
	.mobile-mode .field:has(#water-dt) {
		margin-bottom: 12px !important;
	}
	
	.mobile-mode .field:has(#water-dt) .ok-btn,
	.mobile-mode .field:has(#water-dt) .clear-btn {
		width: calc(50% - 6px) !important;
		margin: 6px 3px !important;
	}
	
	/* Migliora la disposizione dei campi di input */
	.mobile-mode .row:has(.field:not(:has(#water-dt))) {
		display: grid !important;
		grid-template-columns: 1fr 1fr !important;
		gap: 12px !important;
		margin-bottom: 12px !important;
		padding: 0 !important;
	}
	
	/* Campi di input per spray e ventola in mobile */
	.mobile-mode #spray-start,
	.mobile-mode #spray-end,
	.mobile-mode #fan-start,
	.mobile-mode #fan-end {
		width: 100% !important;
		min-width: 0 !important;
		font-size: 16px !important;
		box-sizing: border-box !important;
	}
	
	/* Pulsanti OK per spray e ventola in mobile */
	.mobile-mode .field:has(#spray-start) .ok-btn,
	.mobile-mode .field:has(#spray-end) .ok-btn,
	.mobile-mode .field:has(#fan-start) .ok-btn,
	.mobile-mode .field:has(#fan-end) .ok-btn {
		width: 100% !important;
		margin: 8px 0 0 0 !important;
		font-size: 14px !important;
		padding: 10px 8px !important;
		min-height: 44px !important;
		box-sizing: border-box !important;
	}
	
	/* Pulsanti finali in una riga compatta */
	.mobile-mode .row:has(#add-water) {
		display: flex !important;
		flex-direction: row !important;
		justify-content: space-between !important;
		margin-top: 8px !important;
		gap: 8px !important;
	}
	
	/* Pulsanti grafico in una riga su mobile */
	.mobile-mode .row:has(#refresh-day-chart) {
		display: flex !important;
		flex-direction: row !important;
		justify-content: center !important;
		align-items: center !important;
		gap: 8px !important;
		flex-wrap: wrap !important;
	}
	
	.mobile-mode .row:has(#refresh-day-chart) button {
		flex: 1 !important;
		min-width: 0 !important;
		font-size: 14px !important;
		padding: 10px 8px !important;
		min-height: 44px !important;
		box-sizing: border-box !important;
	}
	
	.mobile-mode h1, .mobile-mode h2 {
		font-size: 24px !important;
		margin: 16px 0 12px 0 !important;
	}
	
	.mobile-mode canvas {
		max-width: 100% !important;
		height: auto !important;
	}
	
	.mobile-mode .legend {
		padding: 12px !important;
		gap: 8px !important;
	}
	
	.mobile-mode .legend span {
		font-size: 12px !important;
		padding: 6px 10px !important;
	}
	
	/* Container scrollabile per tabelle */
	.table-container {
		overflow-x: auto;
		overflow-y: visible;
		-webkit-overflow-scrolling: touch;
		margin: 0;
		padding: 0;
	}
	
	/* Forza la larghezza della tabella anche se ci sono conflitti */
	.mobile-mode #light-table {
		width: 1200px !important;
		min-width: 1200px !important;
		max-width: none !important;
		table-layout: fixed !important;
	}
	
	/* Regola molto specifica per sovrascrivere qualsiasi conflitto */
	body.mobile-mode .table-container table#light-table {
		width: 1200px !important;
		min-width: 1200px !important;
		max-width: none !important;
		table-layout: fixed !important;
	}
	
	/* Container scrollabile per tabelle mobile */
	.mobile-mode .table-container {
		overflow-x: auto !important;
		overflow-y: visible !important;
		-webkit-overflow-scrolling: touch !important;
		margin: 0 -8px !important; /* Estende fino ai bordi dello schermo */
		padding: 0 8px !important;
		display: block !important;
		width: 100% !important;
	}
	
	/* Container specifico per tabella animali su mobile */
	.mobile-mode .table-container:has(#animals-table) {
		overflow-x: auto !important;
		overflow-y: visible !important;
		-webkit-overflow-scrolling: touch !important;
		margin: 0 -8px !important;
		padding: 0 8px !important;
		display: block !important;
		width: 100% !important;
	}
	
	/* Scrollbar per container tabelle */
	.table-container::-webkit-scrollbar {
		height: 6px;
	}
	
	.table-container::-webkit-scrollbar-track {
		background: #f1f1f1;
		border-radius: 3px;
	}
	
	.table-container::-webkit-scrollbar-thumb {
		background: #888;
		border-radius: 3px;
	}
	
	.table-container::-webkit-scrollbar-thumb:hover {
		background: #555;
	}
	
	.dark-mode .table-container::-webkit-scrollbar-track {
		background: #333;
	}
	
	.dark-mode .table-container::-webkit-scrollbar-thumb {
		background: #666;
	}
	
	.dark-mode .table-container::-webkit-scrollbar-thumb:hover {
		background: #888;
	}
	
	.mobile-mode .table-container::-webkit-scrollbar {
		height: 8px !important;
	}
	
	.mobile-mode .table-container::-webkit-scrollbar-track {
		background: #f1f1f1 !important;
		border-radius: 4px !important;
	}
	
	.mobile-mode .table-container::-webkit-scrollbar-thumb {
		background: #888 !important;
		border-radius: 4px !important;
	}
	
	.mobile-mode .table-container::-webkit-scrollbar-thumb:hover {
		background: #555 !important;
	}
	
	/* Dark mode scrollbar */
	.dark-mode.mobile-mode .table-container::-webkit-scrollbar-track {
		background: #333 !important;
	}
	
	.dark-mode.mobile-mode .table-container::-webkit-scrollbar-thumb {
		background: #666 !important;
	}
	
	.dark-mode.mobile-mode .table-container::-webkit-scrollbar-thumb:hover {
		background: #888 !important;
	}
	
	
	
	/* Toggle sections - nasconde le sezioni di inserimento dati */
	.toggle-section {
		display: none !important;
	}
	
	.toggle-section.visible {
		display: block !important;
	}
	
	/* Forza le regole toggle anche in modalità mobile */
	.mobile-mode .toggle-section {
		display: none !important;
	}
	
	.mobile-mode .toggle-section.visible {
		display: block !important;
	}
	
	/* In modalità mobile locked, nasconde le sezioni toggle */
	.mobile-mode.locked-mode .toggle-section {
		display: none !important;
		opacity: 0.3 !important;
		pointer-events: none !important;
		user-select: none !important;
		-webkit-user-select: none !important;
		-moz-user-select: none !important;
		-ms-user-select: none !important;
		-webkit-touch-callout: none !important;
	}
	
	/* Stili per i pulsanti toggle */
	.toggle-btn {
		cursor: pointer !important;
		user-select: none !important;
		transition: all 0.3s ease !important;
		touch-action: manipulation !important;
		-webkit-tap-highlight-color: transparent !important;
	}
	
	.toggle-btn:hover {
		opacity: 0.8 !important;
	}
	
	/* Stili per dispositivi touch */
	.toggle-btn:active {
		opacity: 0.7 !important;
		transform: scale(0.98) !important;
	}
	
	/* Migliora l'esperienza touch */
	@media (pointer: coarse) {
		.toggle-btn {
			min-height: 44px !important;
			padding: 12px 16px !important;
		}
		
		.ok-btn, .clear-btn {
			min-height: 44px !important;
			touch-action: manipulation !important;
			-webkit-tap-highlight-color: transparent !important;
		}
		
		.ok-btn:active, .clear-btn:active {
			opacity: 0.7 !important;
			transform: scale(0.98) !important;
		}
	}
	
	.toggle-btn::after {
		content: " ▼" !important;
		font-size: 12px !important;
		opacity: 0.7 !important;
	}
	
	.toggle-btn.collapsed::after {
		content: " ▶" !important;
	}
	
	/* Sfondo personalizzato per il blocco titolo */
	.header-decorative {
		position: relative !important;
		overflow: hidden !important;
	}
	
	.header-decorative::before {
		content: '' !important;
		position: absolute !important;
		top: 0 !important;
		left: 0 !important;
		right: 0 !important;
		bottom: 0 !important;
		background-size: cover !important;
		background-position: center !important;
		background-repeat: no-repeat !important;
		z-index: 0 !important;
		opacity: 0.3 !important;
	}
	
	.header-decorative > * {
		position: relative !important;
		z-index: 1 !important;
	}
	
	/* Pulsante per cambiare/rimuovere sfondo */
	.background-upload-btn {
		position: absolute !important;
		top: 8px !important;
		right: 8px !important;
		background: rgba(255, 255, 255, 0.9) !important;
		border: 1px solid rgba(46, 125, 50, 0.3) !important;
		border-radius: 50% !important;
		width: 32px !important;
		height: 32px !important;
		cursor: pointer !important;
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
		font-size: 16px !important;
		z-index: 2 !important;
		transition: all 0.3s ease !important;
	}
	
	.background-upload-btn:hover {
		background: rgba(255, 255, 255, 1) !important;
		border-color: var(--primary-green) !important;
		transform: scale(1.1) !important;
	}
	
	/* Stato quando c'è uno sfondo personalizzato */
	.background-upload-btn.has-background {
		background: rgba(220, 53, 69, 0.9) !important;
		border-color: rgba(220, 53, 69, 0.5) !important;
		color: white !important;
	}
	
	.background-upload-btn.has-background:hover {
		background: rgba(220, 53, 69, 1) !important;
		border-color: #dc3545 !important;
	}
	
	/* Modalità mobile per pulsante sfondo */
	.mobile-mode .background-upload-btn {
		width: 40px !important;
		height: 40px !important;
		font-size: 18px !important;
		top: 12px !important;
		right: 12px !important;
		background: rgba(255, 255, 255, 0.95) !important;
		border-width: 2px !important;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
	}
	
	.mobile-mode .background-upload-btn:active {
		transform: scale(0.95) !important;
		background: rgba(255, 255, 255, 1) !important;
	}
	
	.mobile-mode .background-upload-btn.has-background:active {
		background: rgba(220, 53, 69, 1) !important;
		transform: scale(0.95) !important;
	}
	
	/* Input file nascosto */
	.background-upload-input {
		display: none !important;
	}
	
	/* Console mobile */
	.mobile-mode #control-console {
		width: 100% !important;
		position: fixed !important;
		top: 0 !important;
		left: 0 !important;
		right: 0 !important;
		z-index: 9999 !important;
		border-radius: 0 !important;
		flex-direction: column !important;
		align-items: center !important;
		justify-content: center !important;
		padding: 8px 12px !important;
		gap: 4px !important;
	}
	
	.mobile-mode #control-console > div:first-child {
		display: none !important; /* Nasconde status in mobile */
	}
	
	/* Stili per ultima sincronizzazione in mobile */
	.mobile-mode #last-sync {
		order: 3 !important;
		font-size: 10px !important;
		color: #666 !important;
		text-align: center !important;
		line-height: 1.2 !important;
		width: 100% !important;
		margin-top: 4px !important;
		word-wrap: break-word !important;
	}
	
	.mobile-mode #control-console > div:nth-child(2),
	.mobile-mode #control-console > div:nth-child(3) {
		display: flex !important;
		gap: 8px !important;
		flex: 1 !important;
		justify-content: center !important;
	}
	
	.mobile-mode #control-console button {
		min-height: 40px !important;
		padding: 8px 12px !important;
		font-size: 12px !important;
		width: auto !important;
		flex: 1 !important;
		max-width: 80px !important;
	}
	
	/* Spazio per console mobile */
	.mobile-mode body {
		padding-top: 60px !important;
	}
	.dark-mode #sync-data:hover {
		background: #90caf9 !important;
	}
	
	/* Stili per il modal delle soglie */
	.dark-mode #water-settings-modal > div {
		background: #333 !important;
		color: #ffffff !important;
	}
	.dark-mode #water-settings-modal h2 {
		color: #ffffff !important;
	}
	.dark-mode #water-settings-modal p {
		color: #cccccc !important;
	}
	.dark-mode #water-settings-modal input {
		background: #444 !important;
		color: #ffffff !important;
		border-color: #666 !important;
	}
	.dark-mode #water-settings-modal .threshold-item {
		background: #444 !important;
		border-color: #666 !important;
	}
	.dark-mode #last-sync {
		color: #cccccc !important;
	}
	.dark-mode .status-indicator {
		background: #4caf50 !important;
		color: white !important;
	}
	.dark-mode .status-indicator.syncing {
		background: #ff9800 !important;
	}
	.dark-mode .status-indicator.error {
		background: #ff5252 !important;
		color: #ffffff !important;
		box-shadow: 0 0 8px rgba(255, 82, 82, 0.4) !important;
	}
	
	/* Stili per il titolo editabile */
	#main-title:hover {
		border-color: #ddd !important;
	}
	#main-title:focus {
		border-color: #1976d2 !important;
		outline: none;
		background: rgba(25, 118, 210, 0.05);
	}
	.dark-mode #main-title:hover {
		border-color: #666 !important;
	}
	.dark-mode #main-title:focus {
		border-color: #64b5f6 !important;
		background: rgba(100, 181, 246, 0.1);
	}
	
	/* Stili per il sottotitolo editabile */
	#main-subtitle:hover {
		border-color: #ccc !important;
	}
	#main-subtitle:focus {
		border-color: var(--primary-green) !important;
		outline: none;
		background: rgba(46, 125, 50, 0.05);
	}
	.dark-mode #main-subtitle:hover {
		border-color: #555 !important;
	}
	.dark-mode #main-subtitle:focus {
		border-color: var(--accent-teal) !important;
		background: rgba(0, 105, 92, 0.1);
	}
	.dark-mode #main-subtitle {
		color: #ccc !important;
	}
	
	/* Stili per l'icona editabile */
	#main-icon:hover {
		border-color: #ddd !important;
		transform: scale(1.1) !important;
	}
	#main-icon:focus {
		border-color: var(--primary-green) !important;
		outline: none;
		background: rgba(46, 125, 50, 0.1);
		transform: scale(1.05) !important;
	}
	.dark-mode #main-icon:hover {
		border-color: #666 !important;
	}
	.dark-mode #main-icon:focus {
		border-color: var(--accent-teal) !important;
		background: rgba(0, 105, 92, 0.1);
	}
	
	/* Stili per modalità locked */
	.locked-mode {
		pointer-events: none !important;
		user-select: none !important;
	}
	
	.locked-mode input,
	.locked-mode select:not(#param-select),
	.locked-mode button:not(#lock-toggle):not(#sync-data):not(#debug-sync):not(#mobile-toggle):not(#dark-mode-toggle):not(#refresh-day-chart):not(#refresh-water-chart):not(#toggle-backgrounds):not(#toggle-fill),
	.locked-mode [contenteditable="true"] {
		pointer-events: none !important;
		opacity: 0.6 !important;
		cursor: not-allowed !important;
	}
	
	/* Pulsanti nelle sezioni toggle in modalità locked - semivisibili ma non cliccabili */
	.locked-mode .toggle-section button {
		pointer-events: none !important;
		opacity: 0.3 !important;
		cursor: not-allowed !important;
		user-select: none !important;
		-webkit-user-select: none !important;
		-moz-user-select: none !important;
		-ms-user-select: none !important;
		-webkit-touch-callout: none !important;
	}
	
	/* Input nelle sezioni toggle in modalità locked - semivisibili ma non cliccabili */
	.locked-mode .toggle-section input,
	.locked-mode .toggle-section select {
		pointer-events: none !important;
		opacity: 0.3 !important;
		cursor: not-allowed !important;
		user-select: none !important;
		-webkit-user-select: none !important;
		-moz-user-select: none !important;
		-ms-user-select: none !important;
		-webkit-touch-callout: none !important;
	}
	
	/* Blocca completamente la selezione dell'icona del titolo */
	.locked-mode #main-icon {
		user-select: none !important;
		-webkit-user-select: none !important;
		-moz-user-select: none !important;
		-ms-user-select: none !important;
		-webkit-touch-callout: none !important;
		-webkit-user-drag: none !important;
		-khtml-user-select: none !important;
		-moz-user-select: none !important;
		-ms-user-select: none !important;
		user-select: none !important;
	}
	
	.locked-mode .toggle-section {
		display: none !important;
		opacity: 0.3 !important;
		pointer-events: none !important;
		user-select: none !important;
		-webkit-user-select: none !important;
		-moz-user-select: none !important;
		-ms-user-select: none !important;
		-webkit-touch-callout: none !important;
	}
	
	.locked-mode .toggle-btn {
		pointer-events: none !important;
		opacity: 0.4 !important;
		cursor: not-allowed !important;
		user-select: none !important;
		-webkit-user-select: none !important;
		-moz-user-select: none !important;
		-ms-user-select: none !important;
		-webkit-touch-callout: none !important;
	}
	
	/* Mantieni funzionali solo scroll e pulsante lock */
	.locked-mode body,
	.locked-mode .table-container {
		pointer-events: auto !important;
	}
	
	.locked-mode #lock-toggle,
	.locked-mode #sync-data,
	.locked-mode #debug-sync,
	.locked-mode #mobile-toggle,
	.locked-mode #dark-mode-toggle,
	.locked-mode #refresh-day-chart,
	.locked-mode #refresh-water-chart,
	.locked-mode #toggle-backgrounds,
	.locked-mode #toggle-fill,
	.locked-mode #param-select {
		pointer-events: auto !important;
		opacity: 1 !important;
		cursor: pointer !important;
	}
	
	/* Stile per pulsante lock attivo */
	#lock-toggle.locked {
		background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%) !important;
		box-shadow: 0 2px 8px rgba(76,175,80,0.3) !important;
	}
	
	.dark-mode #lock-toggle.locked {
		background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%) !important;
		box-shadow: 0 2px 8px rgba(102,187,106,0.4) !important;
	}
	
	/* Colori per tasto lock/unlock in dark mode - stessi colori di light mode */
	.dark-mode #lock-toggle:not(.locked) {
		background: linear-gradient(135deg, #ff7043 0%, #ff5722 100%) !important;
		box-shadow: 0 2px 8px rgba(255,112,67,0.4) !important;
	}
	
	/* Responsive design per schermi molto piccoli */
	@media (max-width: 480px) {
		.mobile-mode body {
			padding: 8px !important;
		}
		
		.mobile-mode .row:has(.field:not(:has(#water-dt))) {
			grid-template-columns: 1fr !important;
			gap: 8px !important;
		}
		
		.mobile-mode .field {
			margin: 6px 0 !important;
		}
		
		.mobile-mode fieldset {
			padding: 8px !important;
			margin: 8px 0 !important;
		}
		
		.mobile-mode #add-water,
		.mobile-mode #clear-water {
			width: 100% !important;
			margin: 6px 0 !important;
			font-size: 16px !important;
		}
		
		.mobile-mode .ok-btn,
		.mobile-mode .clear-btn {
			width: calc(50% - 4px) !important;
			margin: 6px 2px !important;
			font-size: 14px !important;
		}
		
		/* Campi di input per schermi molto piccoli */
		.mobile-mode input[type="time"],
		.mobile-mode input[type="datetime-local"] {
			font-size: 16px !important;
			padding: 10px !important;
		}
	}
	
	/* Responsive design */
	@media (min-width: 768px) {
		body { margin: 18px; }
		.grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
		input[type="number"] { width: 90px; }
		input[type="time"] { width: 100px; }
		input[type="datetime-local"] { width: 210px; }
		canvas { height: 190px; }
	}
	
	/* Safe area per iPhone X e successivi */
	@supports (padding: max(0px)) {
		body {
			padding-left: max(12px, env(safe-area-inset-left));
			padding-right: max(12px, env(safe-area-inset-right));
		}
		
		.mobile-mode body {
			padding-left: max(12px, env(safe-area-inset-left)) !important;
			padding-right: max(12px, env(safe-area-inset-right)) !important;
		}
	}
	
	/* Regole specifiche per dispositivi touch reali */
	@media (pointer: coarse) and (max-width: 768px) {
		body {
			padding: 16px !important;
			-webkit-text-size-adjust: 100% !important;
		}
		
		.mobile-mode body {
			padding: 16px !important;
		}
		
		/* Campi di input per dispositivi touch */
		input[type="datetime-local"],
		input[type="time"] {
			width: 100% !important;
			min-width: 0 !important;
			font-size: 16px !important;
			padding: 14px !important;
			box-sizing: border-box !important;
			-webkit-appearance: none !important;
			border-radius: 8px !important;
			-webkit-text-size-adjust: 100% !important;
			-webkit-tap-highlight-color: transparent !important;
		}
		
		/* Prevenire zoom automatico su iOS */
		input[type="datetime-local"]:focus,
		input[type="time"]:focus {
			font-size: 16px !important;
			-webkit-text-size-adjust: 100% !important;
		}
		
		/* Pulsanti per dispositivi touch */
		button {
			min-height: 48px !important;
			padding: 14px 20px !important;
			font-size: 16px !important;
			touch-action: manipulation !important;
		}
		
		/* Fieldset per dispositivi touch */
		fieldset {
			padding: 16px !important;
			margin: 16px 0 !important;
		}
		
		/* Row per dispositivi touch */
		.row {
			gap: 16px !important;
			margin-bottom: 16px !important;
		}
		
		/* Field per dispositivi touch */
		.field {
			margin: 8px 0 !important;
		}
		
		/* Pulsanti OK e Pulisci per dispositivi touch */
		.ok-btn,
		.clear-btn {
			width: calc(50% - 8px) !important;
			margin: 8px 4px !important;
			font-size: 14px !important;
			padding: 12px 8px !important;
			min-height: 48px !important;
			box-sizing: border-box !important;
		}
		
		/* Layout specifico per campi datetime su dispositivi touch */
		.field:has(#water-dt) {
			display: flex !important;
			flex-direction: column !important;
			gap: 8px !important;
		}
		
		.field:has(#water-dt) input {
			width: 100% !important;
			margin-bottom: 8px !important;
		}
		
		.field:has(#water-dt) .ok-btn,
		.field:has(#water-dt) .clear-btn {
			width: calc(50% - 4px) !important;
			display: inline-block !important;
			margin: 4px 2px !important;
		}
	}
</style>
</head>
<body>

<!-- Console di controllo inchiodata in alto a destra -->
<div id="control-console" style="position: fixed; top: 0; right: 0; z-index: 9999; background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(240,248,255,0.95) 100%); backdrop-filter: blur(15px); padding: 12px 16px; border-radius: 0 0 0 16px; box-shadow: 0 4px 20px rgba(46,125,50,0.15), 0 1px 3px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 6px; align-items: flex-end; width: 320px; box-sizing: border-box; border: 1px solid rgba(255,255,255,0.2);">
	<!-- Status indicator compatto -->
	<div id="status-indicator" class="status-indicator" style="background: #4caf50; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin: 0; white-space: nowrap;">🔄 Sincronizzazione...</div>
	
	<!-- Pulsanti compatti in una riga -->
	<div id="buttons-container" style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap; justify-content: center;">
		<button id="sync-data" style="background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; min-height: 36px; white-space: nowrap; box-shadow: 0 2px 8px rgba(25,118,210,0.3); transition: all 0.2s ease;">🔄 Sync</button>
		<button id="debug-sync" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; min-height: 36px; white-space: nowrap; box-shadow: 0 2px 8px rgba(255,152,0,0.3); transition: all 0.2s ease;">🐛 Debug</button>
		<button id="mobile-toggle" style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; min-height: 36px; white-space: nowrap; box-shadow: 0 2px 8px rgba(156,39,176,0.3); transition: all 0.2s ease;">📱 Mobile</button>
		<button id="dark-mode-toggle" style="background: linear-gradient(135deg, #424242 0%, #303030 100%); color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; min-height: 36px; white-space: nowrap; box-shadow: 0 2px 8px rgba(66,66,66,0.3); transition: all 0.2s ease;">🌙 Dark</button>
		<button id="lock-toggle" style="background: linear-gradient(135deg, #ff5722 0%, #d84315 100%); color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; min-height: 36px; white-space: nowrap; box-shadow: 0 2px 8px rgba(255,87,34,0.3); transition: all 0.2s ease;" title="Attiva modalità solo visualizzazione">🔒 Lock</button>
	</div>
	
	<!-- Ultima sincronizzazione compatta -->
	<div id="last-sync" style="font-size: 10px; color: #666; text-align: right; line-height: 1.2; max-width: 320px; word-wrap: break-word;"></div>
</div>

<!-- Spazio per evitare che il contenuto vada sotto la console -->
<div style="height: 100px; margin-right: 320px;"></div>

<!-- Header decorativo -->
<div class="header-decorative" id="header-section" style="text-align: center; margin-bottom: 32px; padding: 24px; background: linear-gradient(135deg, rgba(46,125,50,0.05) 0%, rgba(0,105,92,0.05) 100%); border-radius: 20px; border: 1px solid rgba(46,125,50,0.1);">
	<button class="background-upload-btn" id="background-upload-btn" title="Cambia sfondo">🖼️</button>
	<input type="file" id="background-upload-input" class="background-upload-input" accept="image/*" />
	<div id="main-icon" contenteditable="true" style="display: inline-block; font-size: 48px; margin-bottom: 8px; animation: float 3s ease-in-out infinite; cursor: pointer; border: 2px solid transparent; padding: 8px; border-radius: 12px; transition: all 0.3s ease; min-width: 64px; text-align: center;">🌱</div>
	<h1 id="main-title" contenteditable="true" style="cursor: pointer; border: 2px solid transparent; padding: 12px 20px; border-radius: 16px; transition: all 0.3s ease; margin: 0 0 8px 0; font-size: 36px; font-weight: 800; background: linear-gradient(135deg, var(--primary-green) 0%, var(--accent-teal) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Paludario</h1>
	<p id="main-subtitle" contenteditable="true" style="cursor: pointer; border: 2px solid transparent; padding: 8px 16px; border-radius: 12px; transition: all 0.3s ease; margin: 0; color: #666; font-size: 16px; font-weight: 500;">Sistema di monitoraggio e controllo ambientale</p>
	<div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 20px;">
		<div class="field" style="margin: 0; position: relative; display: inline-flex; align-items: center;">
			<label for="liters" style="font-weight: 600; font-size: 16px; color: var(--primary-green); margin-right: 8px;">🪣 Volume Acqua</label>
			<div style="position: relative; display: inline-flex; align-items: center;">
				<input id="liters" type="number" step="0.1" min="0" style="width: 120px; font-size: 18px; font-weight: 600; text-align: center; padding-right: 30px;" />
				<span class="unit" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); pointer-events: none; font-size: 14px; color: #666; background: #f3f3f3; border: 1px solid #e0e0e0; padding: 2px 6px; border-radius: 4px;">L</span>
			</div>
		</div>
	</div>
</div>

<style>
@keyframes float {
	0%, 100% { transform: translateY(0px); }
	50% { transform: translateY(-10px); }
}

/* Animazioni per le icone */
@keyframes spray {
	0%, 100% { 
		transform: scale(1) rotate(0deg); 
		opacity: 1;
	}
	25% { 
		transform: scale(1.1) rotate(-5deg); 
		opacity: 0.8;
	}
	50% { 
		transform: scale(1.2) rotate(0deg); 
		opacity: 0.6;
	}
	75% { 
		transform: scale(1.1) rotate(5deg); 
		opacity: 0.8;
	}
}

@keyframes fan {
	0% { transform: rotate(0deg) scale(1); }
	25% { transform: rotate(90deg) scale(1.1); }
	50% { transform: rotate(180deg) scale(1.2); }
	75% { transform: rotate(270deg) scale(1.1); }
	100% { transform: rotate(360deg) scale(1); }
}

@keyframes lights {
	0%, 100% { 
		transform: scale(1);
		filter: brightness(1) hue-rotate(0deg);
	}
	25% { 
		transform: scale(1.1);
		filter: brightness(1.2) hue-rotate(90deg);
	}
	50% { 
		transform: scale(1.2);
		filter: brightness(1.4) hue-rotate(180deg);
	}
	75% { 
		transform: scale(1.1);
		filter: brightness(1.2) hue-rotate(270deg);
	}
}

.animated-icon {
	display: inline-block;
	margin-right: 8px;
}

.animated-icon.spray {
	animation: spray 2s ease-in-out infinite;
}

.animated-icon.fan {
	animation: fan 3s linear infinite;
}

.animated-icon.lights {
	animation: lights 4s ease-in-out infinite;
}

/* Controllo animazioni per performance */
.animated-icon {
	will-change: transform, filter, opacity;
}

/* Pausa animazioni quando non in hover per performance */
fieldset:not(:hover) .animated-icon {
	animation-play-state: paused;
}

fieldset:hover .animated-icon {
	animation-play-state: running;
}

/* Animazioni sempre attive per h2 */
h2 .animated-icon {
	animation-play-state: running !important;
}

/* Riduci animazioni in mobile per performance */
@media (prefers-reduced-motion: reduce) {
	.animated-icon {
		animation: none !important;
	}
}

/* Modalità performance per dispositivi meno potenti */
@media (max-width: 768px) {
	.animated-icon {
		animation-duration: 6s !important;
	}
}

/* Effetti speciali per le luci */
.animated-icon.lights::after {
	content: '✨';
	position: absolute;
	font-size: 12px;
	animation: twinkle 1.5s ease-in-out infinite;
	opacity: 0;
}

@keyframes twinkle {
	0%, 100% { opacity: 0; transform: scale(0.5); }
	50% { opacity: 1; transform: scale(1); }
}

@keyframes water {
	0%, 100% { 
		transform: scale(1) translateY(0px);
		filter: brightness(1) hue-rotate(0deg);
	}
	25% { 
		transform: scale(1.1) translateY(-2px);
		filter: brightness(1.1) hue-rotate(90deg);
	}
	50% { 
		transform: scale(1.2) translateY(-4px);
		filter: brightness(1.2) hue-rotate(180deg);
	}
	75% { 
		transform: scale(1.1) translateY(-2px);
		filter: brightness(1.1) hue-rotate(270deg);
	}
}

.animated-icon.water {
	animation: water 3s ease-in-out infinite;
}

@keyframes clock {
	0%, 100% { 
		transform: rotate(0deg) scale(1);
	}
	25% { 
		transform: rotate(90deg) scale(1.05);
	}
	50% { 
		transform: rotate(180deg) scale(1.1);
	}
	75% { 
		transform: rotate(270deg) scale(1.05);
	}
}

.animated-icon.clock {
	animation: clock 8s linear infinite;
}

@keyframes bounce {
	0%, 100% { transform: translateY(0px); }
	50% { transform: translateY(-8px); }
}

.animated-icon.bounce {
	animation: bounce 2s ease-in-out infinite;
}

@keyframes pulse {
	0%, 100% { 
		transform: scale(1);
		opacity: 1;
	}
	50% { 
		transform: scale(1.1);
		opacity: 0.8;
	}
}

.animated-icon.pulse {
	animation: pulse 2s ease-in-out infinite;
}

/* Stili per header decorativo in dark mode */
.dark-mode .header-decorative {
	background: linear-gradient(135deg, rgba(0,105,92,0.1) 0%, rgba(46,125,50,0.1) 100%) !important;
	border-color: rgba(0,105,92,0.2) !important;
}

.dark-mode .header-decorative p {
	color: #666 !important;
}
</style>

<h2 style="margin: 0 0 16px 0;"><span class="animated-icon bounce">🐾</span> Gestione Animali</h2>

<fieldset>
	<legend class="toggle-btn" data-target="animal-form">🐾 Nuovo Animale</legend>
	<div class="row toggle-section" id="animal-form">
		<div class="field">
			<label for="animal-species">🐟 Specie/Razza</label>
			<input id="animal-species" type="text" placeholder="es. Carassius auratus" />
		</div>
		<div class="field">
			<label for="animal-type">🏷️ Tipo</label>
			<select id="animal-type">
				<option value="pesce">🐟 Pesce</option>
				<option value="mollusco">🐚 Mollusco</option>
				<option value="crostaceo">🦐 Crostaceo</option>
			</select>
		</div>
		<div class="field">
			<label for="animal-count">🔢 Esemplari</label>
			<input id="animal-count" type="number" min="1" step="1" value="1" />
		</div>
		<div class="field">
			<label for="animal-males">♂️ Maschi</label>
			<input id="animal-males" type="number" min="0" step="1" value="0" />
		</div>
		<div class="field">
			<label for="animal-females">♀️ Femmine</label>
			<input id="animal-females" type="number" min="0" step="1" value="0" />
		</div>
		<div class="field">
			<label for="animal-purchase-date">📅 Data Acquisto</label>
			<input id="animal-purchase-date" type="date" />
		</div>
		<div class="field">
			<label for="animal-status">🏥 Stato</label>
			<select id="animal-status">
				<option value="vivo">🟢 Vivo</option>
				<option value="morto">🔴 Morto</option>
				<option value="malato">🟡 Malato</option>
				<option value="gravida">🟣 Gravidanza</option>
			</select>
		</div>
		<button id="add-animal">➕ Aggiungi</button>
		<button id="clear-animal">🧹 Pulisci</button>
	</div>
</fieldset>

<div class="table-container">
<table id="animals-table">
	<thead>
		<tr>
			<th>🐟 Specie/Razza</th>
			<th>🏷️ Tipo</th>
			<th>🔢 Esemplari</th>
			<th>♂️ Maschi</th>
			<th>♀️ Femmine</th>
			<th>📅 Data Acquisto</th>
			<th>🏥 Stato</th>
			<th>⚙️ Azioni</th>
		</tr>
	</thead>
	<tbody></tbody>
</table>
</div>

<div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; margin-top: 32px; flex-wrap: nowrap;">
	<h2 style="margin: 0; white-space: nowrap;"><span class="animated-icon water">💧</span> Valori Acqua</h2>
	<button id="water-settings-btn" style="background: #ff9800; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold; min-height: 36px;">⚙️ Soglie</button>
</div>
<fieldset>
	<legend class="toggle-btn" data-target="water-form">➕ Nuovo valore</legend>
	<div class="toggle-section" id="water-form">
		<div class="row">
			<div class="field">
				<label for="water-dt">📅 Data/Ora</label>
				<input id="water-dt" type="datetime-local" />
				<button class="tiny ok-btn" data-for="water-dt">OK</button>
				<button class="tiny clear-btn" data-for="water-dt">Pulisci</button>
			</div>
		</div>
		<div class="row">
			<div class="field"><label for="ph">🧪 pH</label><input id="ph" type="number" step="0.01" min="0" /></div>
			<div class="field"><label for="kh">⚗️ KH</label><input id="kh" type="number" step="0.1" min="0" /><span class="unit">dKH</span></div>
			<div class="field"><label for="gh">🔬 GH</label><input id="gh" type="number" step="0.1" min="0" /><span class="unit">dGH</span></div>
			<div class="field"><label for="no2">⚠️ NO2</label><input id="no2" type="number" step="0.01" min="0" /><span class="unit">mg/L</span></div>
			<div class="field"><label for="no3">⚠️ NO3</label><input id="no3" type="number" step="0.1" min="0" /><span class="unit">mg/L</span></div>
			<div class="field"><label for="nh4">☠️ NH4</label><input id="nh4" type="number" step="0.01" min="0" /><span class="unit">mg/L</span></div>
			<div class="field"><label for="temp">🌡️ Temperatura</label><input id="temp" type="number" step="0.1" min="0" /><span class="unit">°C</span></div>
			<div class="field"><label for="cond">⚡ Conducibilità</label><input id="cond" type="number" step="1" min="0" /><span class="unit">µS/cm</span></div>
			<button id="add-water">➕ Aggiungi</button>
			<button id="clear-water">🧹 Pulisci</button>
		</div>
	</div>
</fieldset>


<div class="row water-chart-controls">
	<div class="field">
		<label for="param-select">📈 Parametro per grafico</label>
		<select id="param-select">
			<option value="ph">🧪 pH</option>
			<option value="kh">⚗️ KH</option>
			<option value="gh">🔬 GH</option>
			<option value="no2">⚠️ NO2</option>
			<option value="no3">⚠️ NO3</option>
			<option value="nh4">☠️ NH4</option>
			<option value="temp">🌡️ Temperatura</option>
			<option value="cond">⚡ Conducibilità</option>
		</select>
	</div>
	<button id="refresh-water-chart">🔄 Aggiorna grafico</button>
</div>
<canvas id="waterChart"></canvas>

<!-- Modal per impostazioni soglie acqua -->
<div id="water-settings-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; overflow-y: auto;">
	<div style="background: white; margin: 20px auto; max-width: 600px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
		<div style="padding: 20px; border-bottom: 1px solid #eee;">
			<div style="display: flex; justify-content: space-between; align-items: center;">
				<h2 style="margin: 0; color: #333;">⚙️ Soglie Parametri Acqua</h2>
				<button id="close-settings-modal" style="background: #f44336; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 16px;">✕</button>
			</div>
			<p style="margin: 8px 0 0 0; color: #666; font-size: 14px;">Imposta i valori minimi e massimi per ogni parametro. Le caselle si coloreranno di rosso se i valori sono fuori soglia.</p>
		</div>
		
		<div style="padding: 20px;">
			<div id="threshold-settings">
				<!-- Le impostazioni verranno generate dinamicamente -->
			</div>
			
			<div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 20px; border-top: 1px solid #eee;">
				<button id="reset-thresholds" style="background: #757575; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 14px;">🔄 Reset</button>
				<button id="save-thresholds" style="background: #4caf50; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 14px;">💾 Salva</button>
			</div>
		</div>
	</div>
</div>

<div class="table-container">
<table id="water-table">
	<thead>
		<tr>
			<th>📅 Data/Ora</th>
			<th>🧪 pH</th><th>📊 ΔpH%</th>
			<th>⚗️ KH</th><th>📊 ΔKH%</th>
			<th>🔬 GH</th><th>📊 ΔGH%</th>
			<th>⚠️ NO2</th><th>📊 ΔNO2%</th>
			<th>⚠️ NO3</th><th>📊 ΔNO3%</th>
			<th>☠️ NH4</th><th>📊 ΔNH4%</th>
			<th>🌡️ Temp °C</th><th>📊 ΔTemp%</th>
			<th>⚡ Cond µS/cm</th><th>📊 ΔCond%</th>
			<th>⚙️ Azioni</th>
		</tr>
	</thead>
	<tbody></tbody>
</table>
</div>

<h2><span class="animated-icon clock">⏰</span> Profilo tipico giornaliero (0–24)</h2>

<div class="grid grid-2">
<fieldset>
	<legend class="toggle-btn" data-target="spray-form"><span class="animated-icon spray">💦</span> Spray Pioggia (intervalli ON)</legend>
	<div class="row toggle-section" id="spray-form">
			<div class="field">
				<label>🕐 Inizio</label><input id="spray-start" type="time" step="60" />
				<button class="tiny ok-btn" data-for="spray-start">OK</button>
			</div>
			<div class="field">
				<label>🕐 Fine</label><input id="spray-end" type="time" step="60" />
				<button class="tiny ok-btn" data-for="spray-end">OK</button>
			</div>
			<button id="add-spray">➕ Aggiungi</button>
			<button id="clear-spray">🧹 Pulisci</button>
		</div>
		<div class="table-container">
		<table id="spray-table">
			<thead><tr><th>🕐 Inizio</th><th>🕐 Fine</th><th>⚙️ Azioni</th></tr></thead>
			<tbody></tbody>
		</table>
		</div>
	</fieldset>

<fieldset>
	<legend class="toggle-btn" data-target="fan-form"><span class="animated-icon fan">💨</span> Ventola Deumidificante (intervalli ON)</legend>
	<div class="row toggle-section" id="fan-form">
			<div class="field">
				<label>🕐 Inizio</label><input id="fan-start" type="time" step="60" />
				<button class="tiny ok-btn" data-for="fan-start">OK</button>
			</div>
			<div class="field">
				<label>🕐 Fine</label><input id="fan-end" type="time" step="60" />
				<button class="tiny ok-btn" data-for="fan-end">OK</button>
			</div>
			<button id="add-fan">➕ Aggiungi</button>
			<button id="clear-fan">🧹 Pulisci</button>
		</div>
		<div class="table-container">
		<table id="fan-table">
			<thead><tr><th>🕐 Inizio</th><th>🕐 Fine</th><th>⚙️ Azioni</th></tr></thead>
			<tbody></tbody>
		</table>
		</div>
	</fieldset>
</div>

<fieldset>
	<legend class="toggle-btn" data-target="air-form">🌡️ Valori Aria</legend>
	<div class="toggle-section" id="air-form">
		<div class="row">
			<div class="field">
				<label for="air-datetime">📅 Data/Ora</label>
				<input id="air-datetime" type="datetime-local" />
				<button class="tiny ok-btn" data-for="air-datetime">OK</button>
				<button class="tiny clear-btn" data-for="air-datetime">Pulisci</button>
			</div>
		</div>
		<div class="row">
			<div class="field">
				<label for="air-temp-min">🌡️ Temp. Min</label>
				<input id="air-temp-min" type="number" step="0.1" min="-50" max="60" />
				<span class="unit">°C</span>
			</div>
			<div class="field">
				<label for="air-temp-max">🌡️ Temp. Max</label>
				<input id="air-temp-max" type="number" step="0.1" min="-50" max="60" />
				<span class="unit">°C</span>
			</div>
			<div class="field">
				<label for="air-humidity-min">💧 Umidità Min</label>
				<input id="air-humidity-min" type="number" step="1" min="0" max="100" />
				<span class="unit">%</span>
			</div>
			<div class="field">
				<label for="air-humidity-max">💧 Umidità Max</label>
				<input id="air-humidity-max" type="number" step="1" min="0" max="100" />
				<span class="unit">%</span>
			</div>
			<button id="add-air">➕ Aggiungi</button>
			<button id="clear-air">🧹 Pulisci</button>
		</div>
	</div>
</fieldset>

<div class="table-container">
<table id="air-table">
	<thead>
		<tr>
			<th>📅 Data/Ora</th>
			<th>🌡️ Temp. Min °C</th>
			<th>🌡️ Temp. Max °C</th>
			<th>💧 Umidità Min %</th>
			<th>💧 Umidità Max %</th>
			<th>⚙️ Azioni</th>
		</tr>
	</thead>
	<tbody></tbody>
</table>
</div>

<fieldset>
	<legend class="toggle-btn" data-target="lights-form"><span class="animated-icon lights">💡</span> Luci RGBW + Plafoniera (0–100%)</legend>
	<div class="row toggle-section" id="lights-form">
		<div class="field">
			<label>🕐 Ora</label><input id="light-time" type="time" step="60" />
			<button class="tiny ok-btn" data-for="light-time">OK</button>
		</div>
		<div class="field">
			<label><span class="color-dot red"></span>R</label><input id="ch1" type="number" min="0" max="100" step="1" /><span class="unit">%</span>
		</div>
		<div class="field">
			<label><span class="color-dot green"></span>G</label><input id="ch2" type="number" min="0" max="100" step="1" /><span class="unit">%</span>
		</div>
		<div class="field">
			<label><span class="color-dot blue"></span>B</label><input id="ch3" type="number" min="0" max="100" step="1" /><span class="unit">%</span>
		</div>
		<div class="field">
			<label><span class="color-dot white"></span>W</label><input id="ch4" type="number" min="0" max="100" step="1" /><span class="unit">%</span>
		</div>
		<div class="field">
			<label><span class="color-dot orange"></span>Plafoniera</label><input id="ch5" type="number" min="0" max="100" step="1" /><span class="unit">%</span>
		</div>
		<button id="add-light">➕ Aggiungi</button>
		<button id="clear-lights">🧹 Pulisci</button>
	</div>
</fieldset>

<div class="table-container">
<table id="light-table">
	<thead>
		<tr><th>🕐 Ora</th><th><span class="color-dot red"></span>R</th><th><span class="color-dot green"></span>G</th><th><span class="color-dot blue"></span>B</th><th><span class="color-dot white"></span>W</th><th><span class="color-dot orange"></span>Plafoniera</th><th>⚙️ Azioni</th></tr>
	</thead>
	<tbody>
		<tr>
			<td>08:00</td>
			<td>100</td>
			<td>50</td>
			<td>25</td>
			<td>75</td>
			<td>80</td>
			<td>Test</td>
		</tr>
		<tr>
			<td>12:00</td>
			<td>80</td>
			<td>60</td>
			<td>40</td>
			<td>90</td>
			<td>70</td>
			<td>Test</td>
		</tr>
		<tr>
			<td>18:00</td>
			<td>60</td>
			<td>70</td>
			<td>55</td>
			<td>85</td>
			<td>60</td>
			<td>Test</td>
		</tr>
		<tr>
			<td>20:00</td>
			<td>90</td>
			<td>45</td>
			<td>30</td>
			<td>95</td>
			<td>85</td>
			<td>Test</td>
		</tr>
		<tr>
			<td>22:00</td>
			<td>70</td>
			<td>80</td>
			<td>65</td>
			<td>70</td>
			<td>75</td>
			<td>Test</td>
		</tr>
	</tbody>
</table>
</div>

<div class="row" style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; align-items: center;">
	<button id="refresh-day-chart">🔄 Aggiorna grafico</button>
	<button id="toggle-backgrounds">🎨 Mostra Sfondi</button>
	<button id="toggle-fill">📊 Grafico Pieno</button>
</div>
<canvas id="dayChart"></canvas>
<div class="legend" id="dayLegend"></div>

<script src="config.js"></script>
<script src="paludario-app.js"></script>
<script src="paludario-functions.js"></script>
<script src="paludario-charts.js"></script>

<script>
// Gestione toggle sections
document.addEventListener('DOMContentLoaded', function() {
    // Trova tutti i pulsanti toggle
    const toggleButtons = document.querySelectorAll('.toggle-btn');
    
    toggleButtons.forEach(button => {
        const targetId = button.getAttribute('data-target');
        const targetSection = document.getElementById(targetId);
        
        if (targetSection) {
            // Inizializza tutte le sezioni come nascoste
            targetSection.classList.remove('visible');
            button.classList.add('collapsed');
            
            // Funzione per gestire il toggle
            function handleToggle() {
                // Se siamo in modalità locked, non permettere l'apertura dei menù
                if (document.body.classList.contains('locked-mode')) {
                    return;
                }
                
                const isVisible = targetSection.classList.contains('visible');
                
                if (isVisible) {
                    // Nascondi la sezione
                    targetSection.classList.remove('visible');
                    button.classList.add('collapsed');
                } else {
                    // Mostra la sezione
                    targetSection.classList.add('visible');
                    button.classList.remove('collapsed');
                }
            }
            
            // Aggiungi event listener per click (desktop)
            button.addEventListener('click', handleToggle);
            
            // Aggiungi event listener per touch (mobile)
            button.addEventListener('touchend', function(event) {
                event.preventDefault();
                handleToggle();
            });
            
            // Aggiungi event listener per touchstart per feedback visivo
            button.addEventListener('touchstart', function(event) {
                event.preventDefault();
                button.style.opacity = '0.7';
            });
            
            // Ripristina opacità quando finisce il touch
            button.addEventListener('touchend', function(event) {
                event.preventDefault();
                button.style.opacity = '1';
            });
        }
    });
    
    // Gestione upload sfondo personalizzato
    const backgroundUploadBtn = document.getElementById('background-upload-btn');
    const backgroundUploadInput = document.getElementById('background-upload-input');
    const headerSection = document.getElementById('header-section');
    
    if (backgroundUploadBtn && backgroundUploadInput && headerSection) {
        // Funzione per aggiornare lo stato del pulsante
        function updateButtonState(hasBackground) {
            if (hasBackground) {
                backgroundUploadBtn.classList.add('has-background');
                backgroundUploadBtn.innerHTML = '🗑️';
                backgroundUploadBtn.title = 'Rimuovi sfondo';
            } else {
                backgroundUploadBtn.classList.remove('has-background');
                backgroundUploadBtn.innerHTML = '🖼️';
                backgroundUploadBtn.title = 'Cambia sfondo';
            }
        }
        
        // Funzione per rimuovere lo sfondo
        function removeBackground() {
            headerSection.style.removeProperty('--custom-background');
            
            // Rimuovi anche dai settings sincronizzati
            if (typeof dataManager !== 'undefined' && dataManager.updateSettings) {
                dataManager.updateSettings({ backgroundImage: null });
            }
            
            updateButtonState(false);
        }
        
        // Carica sfondo salvato dai settings sincronizzati
        function loadBackgroundFromSettings() {
            if (typeof dataManager !== 'undefined' && dataManager.data && dataManager.data.settings) {
                const savedBackground = dataManager.data.settings.backgroundImage;
                if (savedBackground) {
                    headerSection.style.setProperty('--custom-background', `url(${savedBackground})`);
                    updateButtonState(true);
                    return;
                }
            }
            updateButtonState(false);
        }
        
        // Carica sfondo all'avvio - aspetta che i dati siano caricati
        function waitForDataAndLoadBackground() {
            if (typeof dataManager !== 'undefined' && dataManager.data) {
                // I dati sono già caricati
                loadBackgroundFromSettings();
            } else {
                // Aspetta che i dati siano caricati
                setTimeout(waitForDataAndLoadBackground, 100);
            }
        }
        
        // Avvia il caricamento dello sfondo
        waitForDataAndLoadBackground();
        
        // Listener per quando i dati vengono aggiornati (dopo sync o caricamento)
        if (typeof window !== 'undefined') {
            window.addEventListener('dataUpdated', function(event) {
                // Ricarica lo sfondo solo se sono stati aggiornati i settings o caricati i dati
                if (event.detail && (event.detail.type === 'settings' || event.detail.type === 'loadData')) {
                    loadBackgroundFromSettings();
                }
            });
        }
        
        // Click sul pulsante
        backgroundUploadBtn.addEventListener('click', function() {
            // Controlla se c'è uno sfondo nei settings sincronizzati
            const hasBackground = (typeof dataManager !== 'undefined' && 
                                 dataManager.data && 
                                 dataManager.data.settings && 
                                 dataManager.data.settings.backgroundImage);
            
            if (hasBackground) {
                // Se c'è già uno sfondo, rimuovilo
                removeBackground();
            } else {
                // Se non c'è sfondo, apri il file picker
                backgroundUploadInput.click();
            }
        });
        
        // Funzione per ridimensionare l'immagine
        function resizeImage(file, maxWidth = 1200, maxHeight = 800, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                img.onload = function() {
                    // Calcola le nuove dimensioni mantenendo le proporzioni
                    let { width, height } = img;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width *= ratio;
                        height *= ratio;
                    }
                    
                    // Imposta le dimensioni del canvas
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Ridisegna l'immagine
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Converti in base64 con compressione
                    const resizedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    resolve(resizedDataUrl);
                };
                
                img.onerror = function() {
                    reject(new Error('Errore nel caricamento dell\'immagine'));
                };
                
                img.src = URL.createObjectURL(file);
            });
        }
        
        // Gestione selezione file
        backgroundUploadInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                // Controlla la dimensione del file (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert('L\'immagine è troppo grande! Dimensioni massime: 10MB');
                    event.target.value = '';
                    return;
                }
                
                // Mostra un messaggio di caricamento
                const originalText = backgroundUploadBtn.innerHTML;
                backgroundUploadBtn.innerHTML = '⏳';
                backgroundUploadBtn.disabled = true;
                
                // Ridimensiona e comprimi l'immagine
                resizeImage(file)
                    .then(resizedDataUrl => {
                        // Applica lo sfondo
                        headerSection.style.setProperty('--custom-background', `url(${resizedDataUrl})`);
                        
                        // Salva nei settings sincronizzati su GitHub
                        if (typeof dataManager !== 'undefined' && dataManager.updateSettings) {
                            dataManager.updateSettings({ backgroundImage: resizedDataUrl });
                        }
                        
                        // Aggiorna lo stato del pulsante
                        updateButtonState(true);
                        
                    })
                    .catch(error => {
                        console.error('Errore nel caricamento dell\'immagine:', error);
                        alert('Errore nel caricamento dell\'immagine. Prova con un\'immagine più piccola o in formato diverso.');
                    })
                    .finally(() => {
                        // Ripristina il pulsante
                        backgroundUploadBtn.disabled = false;
                        if (typeof dataManager !== 'undefined' && 
                            dataManager.data && 
                            dataManager.data.settings && 
                            dataManager.data.settings.backgroundImage) {
                            backgroundUploadBtn.innerHTML = '🗑️';
                        } else {
                            backgroundUploadBtn.innerHTML = originalText;
                        }
                    });
            }
            
            // Reset del file input per permettere di selezionare lo stesso file
            event.target.value = '';
        });
        
        // Aggiungi CSS per lo sfondo personalizzato
        const style = document.createElement('style');
        style.textContent = `
            .header-decorative::before {
                background-image: var(--custom-background, none) !important;
            }
        `;
        document.head.appendChild(style);
    }
    
    // Gestione modalità locked (solo visualizzazione)
    const lockToggle = document.getElementById('lock-toggle');
    if (lockToggle) {
        let isLocked = false;
        
        lockToggle.addEventListener('click', function() {
            isLocked = !isLocked;
            
            if (isLocked) {
                // Attiva modalità locked
                document.body.classList.add('locked-mode');
                lockToggle.classList.add('locked');
                lockToggle.innerHTML = '🔓 Unlock';
                lockToggle.title = 'Disattiva modalità solo visualizzazione';
                
                // Disabilita contenteditable per titolo, sottotitolo e icona
                const mainTitle = document.getElementById('main-title');
                const mainSubtitle = document.getElementById('main-subtitle');
                const mainIcon = document.getElementById('main-icon');
                
                if (mainTitle) mainTitle.contentEditable = 'false';
                if (mainSubtitle) mainSubtitle.contentEditable = 'false';
                if (mainIcon) mainIcon.contentEditable = 'false';
                
                // Chiudi tutte le sezioni toggle per nascondere i menù
                const allToggleSections = document.querySelectorAll('.toggle-section');
                const allToggleButtons = document.querySelectorAll('.toggle-btn');
                
                allToggleSections.forEach(section => {
                    section.classList.remove('visible');
                });
                
                allToggleButtons.forEach(button => {
                    button.classList.add('collapsed');
                });
                
            } else {
                // Disattiva modalità locked
                document.body.classList.remove('locked-mode');
                lockToggle.classList.remove('locked');
                lockToggle.innerHTML = '🔒 Lock';
                lockToggle.title = 'Attiva modalità solo visualizzazione';
                
                // Riabilita contenteditable per titolo, sottotitolo e icona
                const mainTitle = document.getElementById('main-title');
                const mainSubtitle = document.getElementById('main-subtitle');
                const mainIcon = document.getElementById('main-icon');
                
                if (mainTitle) mainTitle.contentEditable = 'true';
                if (mainSubtitle) mainSubtitle.contentEditable = 'true';
                if (mainIcon) mainIcon.contentEditable = 'true';
                
            }
        });
        
        // Carica stato locked dal localStorage
        const savedLockState = localStorage.getItem('paludario.lockedMode') === 'true';
        if (savedLockState) {
            lockToggle.click(); // Attiva la modalità locked
        }
        
        // Salva stato locked nel localStorage
        lockToggle.addEventListener('click', function() {
            localStorage.setItem('paludario.lockedMode', isLocked.toString());
        });
    }
});
</script>
</body>
</html>
